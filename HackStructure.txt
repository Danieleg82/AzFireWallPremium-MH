Structure of the hack:

INTRO ABOUT FW PREMIUM FEATURES

DEPLOYMENT (BEST IF DONE AT LEAST 1HR BEFORE THE LAB)

TASK1:
ENABLE DIAGNOSTIC LOGS

TASK2
Create Allow ApplicationRule 
Enable IDPS but not TLSi

==============

(doc for IDPS testing: https://learn.microsoft.com/en-us/azure/firewall/premium-deploy)
(doc for TLSi testing: https://techcommunity.microsoft.com/t5/azure-network-security-blog/building-a-poc-for-tls-inspection-in-azure-firewall/ba-p/3676723)

CHALLENGE1:  IDPS for unencrypted traffic

TASK1:
Create FW rules to allow outbound traffic

TASK2:
Enable IDPS inspection

TASK3:
Connect to VM and test HTTP external website with browser (Success)
CURL the HTTP website with malicious user-agent (IDPS will block)
CURL HTTPS website with malicious user-agent (IDP will NOT block)

TASK4
Review Diagnostic logs

================

CHALLENGE2: TLS Inspection and IDPS on encrypted traffic

Task1: 
Enable TLS Inspection

Task2:
Import CER on VM and trust it

Task3:
Revert the useragent IDS signature to DENY and test from VM

Task4:
Test TLS inspection with encrypted traffic

================

CHALLENGE3: Web Categories

Task1:
Create a block rule for gambling websites

Task2:
Test the rule

Task3:
Check the block in logs